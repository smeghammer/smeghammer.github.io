<!DOCTYPE HTML>
<html lang="en">
    <head>
        <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.3/build/pure-min.css" integrity="sha384-cg6SkqEOCV1NbJoCu11+bm0NvBRc8IYLRGXkmNrqUBfTjmMYwNKPWBTIKyw9mHNJ" crossorigin="anonymous">
        <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.3/build/grids-responsive-min.css">
        <link rel="stylesheet" href="/css/site.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta property="og:image" content="https://www.smeghammer.co.uk/images/smeghammer.gif">
        <meta name="twitter:card" content="summary">
        <meta name="description" content="A categorised front end to my backup of the Realm667 data dump. The categorisation is generated from a DOM scrape of the R667 Repository site section. (Note: Not all links work yet.)">
        <meta property="og:title" content="R667 dump categorised browser">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://www.smeghammer.co.uk/test.htm">
        <meta property="og:description" content="A categorised front end to my backup of the Realm667 data dump. The categorisation is generated from a DOM scrape of the R667 Repository site section.">
        <meta property="og:site_name" content="Smeghammer's Doom">
        <meta property="og:locale" content="en_UK">
        <meta name="theme-color" content="#3d6594">
        <link rel="icon" type="image/gif" href="/images/favicon.gif">
        <title>
        R667 dump test
        </title>
    </head>
    <body class="home" data-page="xx" data-pagekey="x">
        <div class="pure-g">
            <div class="pure-u-1 pure-u-md-1-8 pure-u-lg-1-12"></div>
            <div class="pure-u-1 pure-u-md-3-4 pure-u-lg-5-6">
                <h1 class="centre">R667 dump test</h1>
            </div>
            <div class="pure-u-1 pure-u-md-1-8 pure-u-lg-1-12"></div>
        </div>
        
        <!-- top menu -->
        <div class="pure-g">
            <div class="pure-u-1 pure-u-md-1-8 pure-u-lg-2-24"></div>
            <div class="pure-u-1 pure-u-md-3-4 pure-u-lg-20-24 menubar">
                <div class="pure-menu pure-menu-horizontal centre" id="menubar" >
                    <!-- inject menu -->
                </div>
            </div>
            <div class="pure-u-1 pure-u-md-1-8 pure-u-lg-2-24"></div>
        </div>

        <!-- contents -->
        <div class="pure-g contents">
            <div class="pure-u-1 pure-u-md-1-8 pure-u-lg-1-12"></div>
            <div class="pure-u-1 pure-u-md-3-4 pure-u-lg-5-6">
                <!--<h2>Categorised list</h2>-->
                <div id="sausage"></div>
            </div>
            <div class="pure-u-1 pure-u-md-1-8 pure-u-lg-1-12"></div>
        </div>
        <!-- inject footer -->
        <div id="footer"></div>
        <script src="/js/jquery.js"></script>
        <script src="/js/site.js"></script> 
        <script>
            let _items = {};
            $.getJSON('/data/r667output.json',function(data){
                console.log(data);
                //first pass: make empty root level topic object stubs:
                for(var item in data){
                    if(!_items[data[item]['topic']]){
                        _items[data[item]['topic']] = {};
                    }
                }

                //second pass: for each top level object entry, make second level section object stubs:
                for(topic in _items){
                    for(var item in data){
                        if(topic === data[item]['topic'] &&! _items[topic][data[item]['section']]){
                            _items[topic][data[item]['section']] = {};
                        }
                    }
                }
                //third pass: append data to correct key:
                for(item in data){
                    _items[ data[item]['topic'] ][data[item]['section']][item] = data[item];
                }

                console.log(_items);
                
                /* now, _items can be used to generate DOM output: */
                $('#sausage').empty();
                for(topic in _items){
                    console.log(topic);
                    $('#sausage').append('<h2>'+topic+'</h2>');
                    for(section in _items[topic]){
                        $('#sausage').append('<h3>'+section+'</h3>');
                        $('#sausage').append('<ul>');
                        for(thing in _items[topic][section]){
                            /* work out path */
                            let _path = thing.substr(0,1).toLowerCase();
                            if(parseInt(_path)){
                                _path = '_num'
                            }
                            console.log(thing.substr(0,1).toLowerCase());
                            console.log('/' + _path + '/' + thing.replace(/ /g,'') + '.zip');
                            $('#sausage > ul').append('\t<li><a href="https://github.com/smeghammer/r667_mirror/raw/master/' + _path + '/' + thing.replace(/ /g,'') + '.zip">'+thing+'</a></li>\n');
                            /* TODO */
                        }
//                        $('#sausage').append('</ul>');
                    }
                }
            });
        </script>
    </body>
</html>
